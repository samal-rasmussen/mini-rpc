# mini-rpc

A tiny typesafe rpc implementation that relies on only three npm packages - Zod, Typescript, and ws - to get the job done.

Inspired by tRPC (https://trpc.io/), but is here implemented and presented as a minimal design pattern that you can use however you like, rather than as a whole opinionated library that you have to import and use as is.

You define the api once and import use the same api types for the server and client. In this implementation all communication is over a persistent WebSocket connection, but you may make your own data communication implementation, that can communication however you like.

Three types of operations are supported: Get, set, and subscribe.

Get and set ar practically the same, but it is a useful distinction so you can do read/write separation, which is useful on the backend.

Subscriptions can be defined on the same resources as get and set operations, and are rxjs compatible.

All actions are on statically typed resource urls that support statically parsed params. You then define the request and response types for such a resource.

# How to use

## Resources
First you need to define your resources using a resource object like in `src/shared/resources.ts`.

## Server
Then you define a router with resource handlers like in `src/server/router.ts`.

## Client
The Client is autogenerated using the resource object as the type and a Proxy object as the implementation, and you can just jump in and use the statically typed client like in `src/client/client-example.ts`.

```ts
import { makeClient } from './client.js';

const client = await makeClient();

const result1 = await client['/resourceA'].get({
	params: null,
});
console.log('result 1', result1);

const result2 = await client['/resourceB/:id'].get({
	params: { id: '123' },
});
console.log('result 2', result2);

client['/resourceB/:id']
	.subscribe({
		params: { id: '123' },
	})
	.subscribe({
		next: (val) => {
			console.log('received subscription val', val);
		},
	});

await client['/resourceB/:id'].set({
	params: { id: '123' },
	request: { name: '321' },
});

```

# Run example

Run these three commands in three separate terminals:
```
$ npm run build
$ npm run server
$ npm run client
```
